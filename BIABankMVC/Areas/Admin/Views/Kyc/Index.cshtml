@using BankingSystemMVC.Areas.Admin.Models.ViewModels.Kyc
@using BankingSystemMVC.Models.Kyc
@using BankingSystemMVC.Models.ViewModels.Kyc
@model List<AdminKycPendingViewModel>

@{
    ViewData["Title"] = "KYC Review";
    var pendingList = Model.Where(x => x.Status == KYCStatus.Pending).ToList();
    var underReviewList = Model.Where(x => x.Status == KYCStatus.UnderReview).ToList();
    var totalCount = Model.Count;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1><i class="bi bi-file-earmark-check"></i> KYC Review</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">Dashboard</a></li>
                    <li class="breadcrumb-item active">KYC Review</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted text-uppercase mb-1">Total Submissions</h6>
                            <h2 class="mb-0 fw-bold">@totalCount</h2>
                        </div>
                        <div>
                            <i class="bi bi-file-earmark-check display-3 opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted text-uppercase mb-1">Pending Review</h6>
                            <h2 class="mb-0 fw-bold">@pendingList.Count</h2>
                        </div>
                        <div>
                            <i class="bi bi-clock display-3 opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted text-uppercase mb-1">Under Review</h6>
                            <h2 class="mb-0 fw-bold">@underReviewList.Count</h2>
                        </div>
                        <div>
                            <i class="bi bi-hourglass-split display-3 opacity-50"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- KYC Submissions -->
    <div class="row" id="kycListContainer">
        @await Html.PartialAsync("_KycList", Model)
    </div>
</div>

<style>
    .opacity-50 {
        opacity: 0.5;
    }
</style>

<script>
    function updateKycList() {
        fetch('@Url.Action("GetKycList", "Kyc", new { area = "Admin" })')
            .then(response => response.text())
            .then(html => {
                document.getElementById('kycListContainer').innerHTML = html;
            })
            .catch(error => console.error('Error updating KYC list:', error));
    }

    setInterval(() => {
        updateKycList();
    }, 30000);
</script>
